<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>TranzyNote Analytics Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0f172a; color: #e2e8f0; padding: 2rem; }
        h1 { color: #818cf8; margin-bottom: 0.5rem; }
        .subtitle { color: #64748b; font-size: 0.9rem; margin-bottom: 1.5rem; }
        h2 { color: #a5b4fc; margin: 1.5rem 0 0.75rem; font-size: 1.1rem; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .card { background: #1e293b; border-radius: 12px; padding: 1.5rem; border: 1px solid #334155; }
        .card .number { font-size: 2.5rem; font-weight: 700; color: #818cf8; }
        .card .label { font-size: 0.85rem; color: #94a3b8; margin-top: 0.25rem; }
        table { width: 100%; border-collapse: collapse; background: #1e293b; border-radius: 12px; overflow: hidden; margin-bottom: 1rem; }
        th, td { padding: 0.75rem 1rem; text-align: left; border-bottom: 1px solid #334155; }
        th { background: #334155; color: #a5b4fc; font-size: 0.85rem; text-transform: uppercase; }
        td { font-size: 0.9rem; }
        .btn { background: #6366f1; color: white; border: none; padding: 0.5rem 1.5rem; border-radius: 8px; cursor: pointer; font-size: 0.9rem; text-decoration: none; display: inline-block; margin-right: 0.5rem; margin-bottom: 0.5rem; }
        .btn:hover { background: #4f46e5; }
        .btn-green { background: #059669; }
        .btn-green:hover { background: #047857; }
        .note { color: #64748b; font-size: 0.8rem; margin-top: 0.5rem; }
        .alert { background: #1e293b; border: 1px solid #f59e0b; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .alert h3 { color: #f59e0b; margin-bottom: 0.5rem; }
        .alert p { color: #94a3b8; font-size: 0.9rem; line-height: 1.5; }
        .alert a { color: #818cf8; }
        .loading { color: #64748b; padding: 1rem; text-align: center; }
        .tag { display: inline-block; background: #334155; color: #a5b4fc; padding: 0.2rem 0.6rem; border-radius: 4px; font-size: 0.75rem; margin-right: 0.3rem; }
        
        /* Responsive */
        @media (max-width: 768px) {
            body { padding: 1rem; }
            h1 { font-size: 1.5rem; }
            .grid { grid-template-columns: 1fr 1fr; gap: 0.75rem; }
            .card { padding: 1rem; }
            .card .number { font-size: 1.75rem; }
            table { display: block; overflow-x: auto; -webkit-overflow-scrolling: touch; }
            th, td { padding: 0.5rem 0.75rem; font-size: 0.8rem; white-space: nowrap; }
            code { word-break: break-all; font-size: 0.7rem; }
            .btn { padding: 0.5rem 1rem; font-size: 0.8rem; min-height: 44px; }
        }
        @media (max-width: 480px) {
            .grid { grid-template-columns: 1fr; }
            h1 { font-size: 1.25rem; }
            .alert { padding: 1rem; }
        }
        img, video { max-width: 100%; height: auto; }
    </style>
</head>
<body>
    <h1>üìä TranzyNote Analytics</h1>
    <p class="subtitle">Real-time visitor tracking via Azure Application Insights</p>

    <div class="alert">
        <h3>üìà Where to View Full Analytics</h3>
        <p>Your site tracks ALL visitors server-side via <strong>Azure Application Insights</strong>. View full data here:</p>
        <br>
        <a class="btn btn-green" href="https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.insights%2Fcomponents" target="_blank">üîó Azure Portal ‚Üí App Insights</a>
        <a class="btn" href="https://www.linkedin.com/company/tranzynote/admin/analytics/" target="_blank">üîó LinkedIn Analytics</a>
        <p class="note" style="margin-top:1rem;">
            <strong>Instrumentation Key:</strong> <code style="color:#818cf8">31328ceb-a213-40bb-89bb-7626669e0eb3</code><br>
            In Azure Portal: Go to Application Insights ‚Üí find your resource ‚Üí click "Logs" or "Usage" to see pageviews, users, sessions, and events from ALL visitors.
        </p>
    </div>

    <h2>üîç Quick Queries for Azure Portal</h2>
    <p class="note" style="margin-bottom:1rem;">Copy these into Azure Portal ‚Üí Application Insights ‚Üí Logs (KQL queries):</p>
    
    <table>
        <thead><tr><th>Metric</th><th>KQL Query</th></tr></thead>
        <tbody>
            <tr><td>Pageviews (last 7 days)</td><td><code>pageViews | where timestamp > ago(7d) | summarize count() by bin(timestamp, 1d)</code></td></tr>
            <tr><td>Unique visitors (last 7 days)</td><td><code>pageViews | where timestamp > ago(7d) | summarize dcount(client_CountryOrRegion) by bin(timestamp, 1d)</code></td></tr>
            <tr><td>Traffic sources</td><td><code>pageViews | where timestamp > ago(7d) | extend src = tostring(customDimensions.utm_source) | summarize count() by src</code></td></tr>
            <tr><td>Download clicks</td><td><code>customEvents | where name contains "download" | where timestamp > ago(7d) | summarize count() by bin(timestamp, 1d)</code></td></tr>
            <tr><td>LinkedIn traffic</td><td><code>pageViews | where timestamp > ago(7d) | where url contains "utm_source=linkedin" | summarize count() by bin(timestamp, 1h)</code></td></tr>
        </tbody>
    </table>

    <h2>üì± This Browser's Local Data</h2>
    <p class="note" style="margin-bottom:1rem;">This section only shows YOUR visits from THIS browser (localStorage). For all visitors, use Azure Portal above.</p>
    
    <div class="grid">
        <div class="card"><div class="number" id="totalVisits">0</div><div class="label">Your Visits</div></div>
        <div class="card"><div class="number" id="totalDownloads">0</div><div class="label">Your Download Clicks</div></div>
        <div class="card"><div class="number" id="totalEvents">0</div><div class="label">Your Events</div></div>
        <div class="card"><div class="number" id="lastVisit">-</div><div class="label">Your Last Visit</div></div>
    </div>

    <h2>UTM Attribution (Your Browser)</h2>
    <div class="grid">
        <div class="card">
            <div class="label">First Touch</div>
            <div id="firstTouch" style="margin-top:0.5rem; font-size:0.9rem;">-</div>
        </div>
        <div class="card">
            <div class="label">Last Touch</div>
            <div id="lastTouch" style="margin-top:0.5rem; font-size:0.9rem;">-</div>
        </div>
    </div>

    <h2>Source Breakdown (Your Browser)</h2>
    <table>
        <thead><tr><th>Source</th><th>Events</th></tr></thead>
        <tbody id="sourceTable"></tbody>
    </table>

    <h2>Recent Events (Your Browser, Last 20)</h2>
    <table>
        <thead><tr><th>Time</th><th>Category</th><th>Action</th><th>Label</th><th>Page</th></tr></thead>
        <tbody id="eventsTable"></tbody>
    </table>

    <div style="margin-top:2rem;">
        <button class="btn" onclick="loadStats()">Refresh Local</button>
        <button class="btn" style="background:#ef4444;" onclick="resetStats()">Reset Local Data</button>
    </div>

    <script>
    function loadStats() {
        var events = JSON.parse(localStorage.getItem('tn_events') || '[]');
        var visitor = {
            visits: parseInt(localStorage.getItem('tn_visit_count') || '0', 10),
            downloads: parseInt(localStorage.getItem('tn_download_count') || '0', 10)
        };
        var firstUTM = JSON.parse(localStorage.getItem('tn_utm_first') || '{}');
        var lastUTM = JSON.parse(localStorage.getItem('tn_utm_last') || '{}');

        document.getElementById('totalVisits').textContent = visitor.visits;
        document.getElementById('totalDownloads').textContent = visitor.downloads;
        document.getElementById('totalEvents').textContent = events.length;
        
        var lastEvt = events[events.length - 1];
        document.getElementById('lastVisit').textContent = lastEvt ? new Date(lastEvt.ts).toLocaleString() : '-';
        document.getElementById('lastVisit').style.fontSize = '0.9rem';

        document.getElementById('firstTouch').textContent = Object.keys(firstUTM).length ? JSON.stringify(firstUTM, null, 2) : '(direct)';
        document.getElementById('lastTouch').textContent = Object.keys(lastUTM).length ? JSON.stringify(lastUTM, null, 2) : '(direct)';

        var sources = {};
        events.forEach(function(e) {
            var src = (e.attribution && e.attribution.last_touch && e.attribution.last_touch.utm_source) || 'organic/direct';
            sources[src] = (sources[src] || 0) + 1;
        });
        var sourceHTML = '';
        Object.keys(sources).sort(function(a,b) { return sources[b] - sources[a]; }).forEach(function(s) {
            sourceHTML += '<tr><td>' + s + '</td><td>' + sources[s] + '</td></tr>';
        });
        document.getElementById('sourceTable').innerHTML = sourceHTML || '<tr><td colspan="2">No local data</td></tr>';

        var recent = events.slice(-20).reverse();
        var evtHTML = '';
        recent.forEach(function(e) {
            evtHTML += '<tr><td>' + new Date(e.ts).toLocaleTimeString() + '</td><td>' + e.category + '</td><td>' + e.action + '</td><td>' + (e.label || '') + '</td><td>' + e.page + '</td></tr>';
        });
        document.getElementById('eventsTable').innerHTML = evtHTML || '<tr><td colspan="5">No local events</td></tr>';
    }

    function resetStats() {
        if (!confirm('Reset local analytics data? This cannot be undone.')) return;
        localStorage.removeItem('tn_events');
        localStorage.removeItem('tn_visit_count');
        localStorage.removeItem('tn_download_count');
        localStorage.removeItem('tn_utm_first');
        localStorage.removeItem('tn_utm_last');
        loadStats();
        alert('Local analytics data cleared!');
    }

    loadStats();
    </script>
</body>
</html>
